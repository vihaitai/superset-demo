"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1459],{61459:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var n=r(96540),a=r(62952),l=r(58863),o=r(96627),s=r(7349),u=r(32142),c=r(86444),i=r(85867),d=r(71194),f=r(96453),h=r(81163),g=r(51536),p=r(2445);const{RadioButtonControl:m}=h.A,v=f.I4.div`
  text-align: center;
`;function C({formData:e,setControlValue:t}){const{extraControlsOptions:r,extraControlsHandler:a,extraValue:l}=function({formData:e,setControlValue:t}){const{stack:r,area:a}=e,[l,o]=(0,n.useState)(null!=r?r:void 0);return(0,n.useEffect)((()=>{o(r)}),[r]),{extraControlsOptions:(0,n.useMemo)((()=>a?g.RC:[]),[a]),extraControlsHandler:(0,n.useCallback)((e=>{a&&t&&(t("stack",e),o(e))}),[a,t]),extraValue:l}}({formData:e,setControlValue:t});return e.showExtraControls?(0,p.Y)(v,{children:(0,p.Y)(m,{options:r,onChange:a,value:l})}):null}const b=300;function y({formData:e,height:t,width:r,echartOptions:f,groupby:h,labelMap:g,selectedValues:m,setDataMask:v,setControlValue:y,legendData:x=[],onContextMenu:k,onLegendStateChanged:w,onFocusedSeries:V,xValueFormatter:E,xAxis:F,refs:R,emitCrossFilters:D,coltypeMapping:I}){const{stack:O}=e,S=(0,n.useRef)(null);R.echartRef=S;const T=(0,n.useRef)(),M=(0,n.useRef)(null),[Y,A]=(0,n.useState)(0);(0,n.useEffect)((()=>{var e;const t=(null==(e=M.current)?void 0:e.offsetHeight)||0;A(t)}),[e.showExtraControls]);const H=(0,n.useCallback)((e=>{const t=Object.values(m);let r;r=t.includes(e)?t.filter((t=>t!==e)):[e];const n=r.map((e=>g[e]));return{dataMask:{extraFormData:{filters:0===r.length?[]:h.map(((e,t)=>{const r=n.map((e=>e[t]));return null==r?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:r}}))},filterState:{label:n.length?n:void 0,value:n.length?n:null,selectedValues:r.length?r:null}},isCurrentValueSelected:t.includes(e)}}),[h,g,m]),N=(0,n.useCallback)((e=>{D&&v(H(e).dataMask)}),[D,v,H]),j={click:e=>{T.current&&clearTimeout(T.current),T.current=setTimeout((()=>{const{seriesName:t}=e;N(t)}),b)},mouseout:()=>{V(null)},mouseover:e=>{V(e.seriesName)},legendselectchanged:e=>{null==w||w(e.selected)},legendselectall:e=>{null==w||w(e.selected)},legendinverseselect:e=>{null==w||w(e.selected)},contextmenu:async t=>{if(k){var r;t.event.stop();const{data:n,seriesName:i}=t,f=[],h=[],p=t.event.event,m=[...t.name?[t.name]:[],...null!=(r=g[i])?r:[]],v=(0,a.A)(e.groupby);n&&F.type===l.Gw.Time&&f.push({col:F.label===o.Tf?e.granularitySqla:F.label,grain:e.timeGrainSqla,op:"==",val:n[0],formattedVal:E(n[0])}),[...F.type===l.Gw.Category&&n?[F.label]:[],...v].forEach(((e,t)=>f.push({col:e,op:"==",val:m[t],formattedVal:String(m[t])}))),v.forEach(((t,r)=>{const n=g[i][r];h.push({col:t,op:"==",val:n,formattedVal:(0,d.Wy)(m[r],{timeFormatter:(0,s.mo)(e.dateFormat),numberFormatter:(0,u.gV)(e.numberFormat),coltype:null==I?void 0:I[(0,c.A)(t)]})})})),k(p.clientX,p.clientY,{drillToDetail:f,crossFilter:H(i),drillBy:{filters:h,groupbyFieldName:"groupby"}})}}},L={dblclick:e=>{var t;T.current&&clearTimeout(T.current);const r=[e.offsetX,e.offsetY],n=null==(t=S.current)?void 0:t.getEchartInstance();if(null!=n&&n.containPixel("grid",r)){var a;if(!O&&"ec-polygon"===(null==(a=e.target)?void 0:a.type))return;const t=n.getModel(),r=((e,t)=>{let r=e,n=null;for(;r;){const e=r.__ecComponentInfo;if(null!=e){n=t.getComponent(e.mainType,e.index);break}r=r.parent}return n})(e.target,t);if(r){const{name:e}=r,t=x.reduce(((t,r)=>({...t,[r]:r===e})),{});null==w||w(t)}}}};return(0,p.FD)(p.FK,{children:[(0,p.Y)("div",{ref:M,children:(0,p.Y)(C,{formData:e,setControlValue:y})}),(0,p.Y)(i.A,{ref:S,refs:R,height:t-Y,width:r,echartOptions:f,eventHandlers:j,zrEventHandlers:L,selectedValues:m})]})}},85867:(e,t,r)=>{r.d(t,{A:()=>Y});var n=r(96540),a=r(96453),l=r(87052),o=r(65232),s=r(60924),u=r(87817),c=r(49227),i=r(96137),d=r(37909),f=r(35980),h=r(42646),g=r(11078),p=r(35385),m=r(12905),v=r(29055),C=r(71215),b=r(79198),y=r(24672),x=r(56080),k=r(51714),w=r(78431),V=r(87057),E=r(64717),F=r(46809),R=r(81664),D=r(89165),I=r(76530),O=r(21640),S=r(2445);const T=a.I4.div`
  height: ${({height:e})=>e};
  width: ${({width:e})=>e};
`;function M({width:e,height:t,echartOptions:r,eventHandlers:a,zrEventHandlers:l,selectedValues:s={},refs:u},c){const i=(0,n.useRef)(null);u&&(u.divRef=i);const d=(0,n.useRef)(),f=(0,n.useMemo)((()=>Object.keys(s)||[]),[s]),h=(0,n.useRef)([]);(0,n.useImperativeHandle)(c,(()=>({getEchartInstance:()=>d.current}))),(0,n.useEffect)((()=>{i.current&&(d.current||(d.current=(0,o.Ts)(i.current)),Object.entries(a||{}).forEach((([e,t])=>{var r,n;null==(r=d.current)||r.off(e),null==(n=d.current)||n.on(e,t)})),Object.entries(l||{}).forEach((([e,t])=>{var r,n;null==(r=d.current)||r.getZr().off(e),null==(n=d.current)||n.getZr().on(e,t)})),d.current.setOption(r,!0))}),[r,a,l]),(0,n.useEffect)((()=>{d.current&&(d.current.dispatchAction({type:"downplay",dataIndex:h.current.filter((e=>!f.includes(e)))}),f.length&&d.current.dispatchAction({type:"highlight",dataIndex:f}),h.current=f)}),[f]);const g=(0,n.useCallback)((({width:e,height:t})=>{d.current&&d.current.resize({width:e,height:t})}),[]);return(0,n.useEffect)((()=>(g({width:e,height:t}),()=>{var e;return null==(e=d.current)?void 0:e.dispose()})),[]),(0,n.useLayoutEffect)((()=>{g({width:e,height:t})}),[e,t,g]),(0,S.Y)(T,{ref:i,height:t,width:e})}(0,l.Y)([x.a,s.a,u.a,c.a,i.a,d.a,f.a,h.a,g.a,p.a,m.a,v.a,C.a,b.a,y.a,k.a,w.a,V.a,E.a,F.a,R.a,D.a,I.a,O._]);const Y=(0,n.forwardRef)(M)}}]);
//# sourceMappingURL=e6ea2fb302d60a26b837.chunk.js.map